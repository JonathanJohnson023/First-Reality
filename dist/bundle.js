!function(e){var t={};function i(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(a,s,function(t){return e[t]}.bind(null,s));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);class a{constructor(e,t){this.tokenMenu=0,this.menuId=t,this.cursor=document.createElement("img"),this.cursor.className="selected",this.cursor.src="https://www.dropbox.com/s/1pq4d1ksjv3tuoz/FF7Cursor.png?raw=1",this.divShadow=document.createElement("div"),this.divShadow.className="shadow",this.cursorMove=new Audio,this.cursorMove.src="https://www.dropbox.com/s/fiyx4q2mdwynraj/FF7CursorMove.mp3?raw=1",this.cursorMove.volume=.4,this.cursorSelect=new Audio,this.cursorSelect.src="https://www.dropbox.com/s/v04ewrevpnnsz03/FF7CursorSaveLoad.mp3?raw=1",this.cursorSelect.volume=.4,this.menuItems=document.querySelectorAll(`${e}`),this.selectMouseOver=this.selectMouseOver.bind(this),this.keyPressed=this.keyPressed.bind(this),this.selectMouseClick=this.selectMouseClick.bind(this)}selectMouseOver(e){e.preventDefault(),e.target.parentNode.id==this.menuId&&(this.tokenMenu=parseInt(e.target.getAttribute("number")),this.selection(this.tokenMenu),this.cursorMove.play())}selectMouseClick(e){if(e.preventDefault(),e.target.parentNode.id==this.menuId)return this.tokenMenu=parseInt(e.target.getAttribute("number")),this.cursorSelect.play(),this.menuItems[this.tokenMenu]}keyPressed(e){if(e.preventDefault(),38==e.keyCode)this.tokenMenu>0?this.tokenMenu-=1:this.tokenMenu=1,this.selection(this.tokenMenu),this.cursorMove.play();else if(40==e.keyCode)this.tokenMenu<1?this.tokenMenu+=1:this.tokenMenu=0,this.selection(this.tokenMenu),this.cursorMove.play();else if(13==e.keyCode)return this.cursorSelect.play(),this.menuItems[this.tokenMenu]}selection(e){this.menuItems[e].prepend(this.cursor),this.menuItems[e].prepend(this.divShadow)}select(e){return this.menuItems[e]}}class s{constructor(e,t,i,a){this.level=1,this.maxHealth=100,this.health=this.maxHealth,this.KO=!1,this.job=e,this.ctx=t,this.sprite=i,this.index=a,this.frame=0,this.forward=!1,this.back=!1,this.partyHpUi=document.getElementById("party-ui").getContext("2d"),this.partyHpUi.font="26px Final Fantasy",this.spriteHeight(a),this.canvasX=.85*this.ctx.canvas.width,this.canvasY=this.ctx.canvas.height*this.heightFloat+.3*this.ctx.canvas.height}isOdd(e){return 1==Math.abs(e%2)}draw(e){this.forward&&this.frame<=9?this.walkForward(e):this.back&&this.frame>=1?this.walkBack():this.ctx.drawImage(this.sprite,0,0,64,64,this.canvasX,this.canvasY,125,125),this.partyHpUi.clearRect(0,this.index*(this.partyHpUi.canvas.height/4),this.partyHpUi.canvas.width,this.partyHpUi.canvas.height),this.partyHpUi.fillText(this.job,25,(this.index+1)*(this.partyHpUi.canvas.height/4)),this.partyHpUi.fillText(`${this.health} / ${this.maxHealth}`,this.partyHpUi.canvas.width-125,(this.index+1)*(this.partyHpUi.canvas.height/4))}walkForward(e){this.frame++,this.isOdd(this.frame)?this.ctx.drawImage(this.sprite,64,0,64,64,this.canvasX-=parseInt(this.frame+"0"),this.canvasY,125,125):this.frame<=9&&this.ctx.drawImage(this.sprite,0,0,64,64,this.canvasX-=parseInt(this.frame+"0"),this.canvasY,125,125),10==this.frame&&e()}walkBack(){this.frame--,this.isOdd(this.frame)?this.ctx.drawImage(this.sprite,64,0,64,64,this.canvasX+=parseInt(this.frame+"0"),this.canvasY,125,125):this.frame>=1&&this.ctx.drawImage(this.sprite,0,0,64,64,this.canvasX+=parseInt(this.frame+"0"),this.canvasY,125,125)}attack(e){if(e.health<=0)return void console.log("Monster is already dead!");const t=Math.floor(30*Math.random())+15;e.health-=t,e.health<=0?(e.health=0,e.KO=!0,console.log(`Monster defeated! Dealt ${t} damage.`)):console.log(`Dealt ${t} damage to monster. Monster health: ${e.health}`),this.showDamage(t)}showDamage(e){const t=document.createElement("div");t.textContent=`-${e}`,t.style.position="absolute",t.style.color="#ff4444",t.style.fontSize="24px",t.style.fontWeight="bold",t.style.zIndex="1000",t.style.pointerEvents="none",t.style.left="50%",t.style.top="30%",t.style.transform="translateX(-50%)",t.style.animation="damageFloat 1.5s ease-out forwards",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},1500)}spriteHeight(e){let t=Number((e+.5*e).toString().replace(".",""));this.heightFloat=parseFloat(`0.${t}`)}}class n{constructor(e,t){this.level=1,this.maxHealth=100,this.health=this.maxHealth,this.KO=!1,this.ctx=e,this.sprite=new Image,this.sprite.src="Final_Fantasy_1_Enemies & Bosses.png",this.index=t,this.frame=0,this.monsterHpUi=document.getElementById("enemies-ui").getContext("2d"),this.monsterHpUi.font="26px Final Fantasy",this.spriteHeight(t),this.canvasX=this.ctx.canvas.width/8,this.canvasY=this.ctx.canvas.height*this.heightFloat+this.ctx.canvas.height/3.5,this.smallMonsters=[[0,0,36,64]],this.medMonsters=[]}draw(){!this.KO&&this.health>0?this.ctx.drawImage(this.sprite,...this.smallMonsters[0],this.canvasX,this.canvasY,125,200):(this.ctx.save(),this.ctx.globalAlpha=.3,this.ctx.drawImage(this.sprite,...this.smallMonsters[0],this.canvasX,this.canvasY,125,200),this.ctx.restore()),this.monsterHpUi.clearRect(0,this.index*(this.monsterHpUi.canvas.height/4),this.monsterHpUi.canvas.width,this.monsterHpUi.canvas.height);const e=this.health/this.maxHealth;this.monsterHpUi.fillStyle=e>.6?"#00ff00":e>.3?"#ffff00":"#ff0000",this.monsterHpUi.fillText(`Monster ${this.index+1}`,25,(this.index+1)*(this.monsterHpUi.canvas.height/4)),this.monsterHpUi.fillText(`${this.health} / ${this.maxHealth}`,this.monsterHpUi.canvas.width-125,(this.index+1)*(this.monsterHpUi.canvas.height/4)),this.monsterHpUi.fillStyle="#ffffff"}death(){this.KO=!0,this.health=0,console.log(`Monster ${this.index+1} has been defeated!`)}attack(e){if(this.KO||this.health<=0)return;const t=Math.floor(20*Math.random())+10;return e.health-=t,e.health<=0?(e.health=0,e.KO=!0,console.log(`${e.job} has been defeated! Monster dealt ${t} damage.`)):console.log(`Monster dealt ${t} damage to ${e.job}. ${e.job} health: ${e.health}`),t}isAlive(){return!this.KO&&this.health>0}spriteHeight(e){let t=Number((e+.5*e).toString().replace(".",""));this.heightFloat=parseFloat(`0.${t}`)}}class r{constructor(e){this.party=[],this.enemies=[],this.wave=0,this.currentChar=null,this.currentCharIndex=0,this.ctx=e,this.frame=0,this.aniDone=!1,this.partyMenu=new a("#party-moves li","party-moves"),this.wave=0,this.battleState="player-turn",this.turnQueue=[],this.currentTurn=0,this.actionInProgress=!1,this.draw=this.draw.bind(this),this.charIndexIncrease=this.charIndexIncrease.bind(this),this.processTurn=this.processTurn.bind(this)}draw(){this.currentChar=this.party[this.currentCharIndex],this.ctx.width=window.innerWidth,this.ctx.height=window.innerHeight,this.ctx.clearRect(0,0,this.ctx.width,this.ctx.height),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.ctx.width,this.ctx.height),this.drawBackground(),this.addSprites(),this.drawMonsters(),document.body.addEventListener("animationend",()=>{document.body.style.backgroundColor="black",this.aniDone=!0,this.currentChar&&(this.currentChar.forward=!0)})}start(e){const t=new s("Knight",this.ctx,null,0),i=new s("Cleric",this.ctx,null,1),a=new s("Archer",this.ctx,null,2),n=new s("Wizard",this.ctx,null,3);this.party.push(t,i,a,n),this.addEnemy();const r=document.getElementById("party-moves");r.addEventListener("mouseover",this.partyMenu.selectMouseOver),r.addEventListener("click",e=>{this.partySelectEventCallback(e)}),document.addEventListener("keydown",e=>{this.partySelectEventCallback(e)}),this.partyMenu.selection(0)}partySelectEventCallback(e){const t=document.getElementById("party-moves");if(13!=e.keyCode||t.classList.contains("none")){if("click"!=e.type)return this.partyMenu.keyPressed(e);this.onSelect(this.partyMenu.selectMouseClick(e))}else this.onSelect(this.partyMenu.keyPressed(e))}drawBackground(){const e=new Image;e.src="battle_backgrounds.png",this.ctx.drawImage(e,522,5,270,155,0,0,this.ctx.width,this.ctx.height)}addSprites(){this.party.forEach((e,t)=>{let i=new Image;i.src=`image${t}.png`,e.sprite=i,e.index=t,e.draw(this.charIndexIncrease)})}drawMonsters(){this.enemies.forEach((e,t)=>{e.draw()})}onSelect(e){if(this.actionInProgress||"player-turn"!==this.battleState)return;this.actionInProgress=!0;const t=e.innerText;"Attack"===t?this.performAttack():"Defend"===t&&this.performDefend()}performAttack(){const e=this.enemies.filter(e=>e.isAlive());if(0===e.length)return void this.checkBattleEnd();const t=e[Math.floor(Math.random()*e.length)];this.currentChar.back=!1,this.currentChar.forward=!0,this.currentChar.attack(t),setTimeout(()=>{this.currentChar.back=!0,this.currentChar.forward=!1,this.actionInProgress=!1,this.nextTurn()},1e3)}performDefend(){console.log(`${this.currentChar.job} is defending!`),this.currentChar.defending=!0,setTimeout(()=>{this.actionInProgress=!1,this.nextTurn()},500)}nextTurn(){this.checkBattleEnd()||(this.charIndexIncrease(),0===this.currentCharIndex&&(this.battleState="enemy-turn",this.enemyTurn()))}enemyTurn(){const e=this.enemies.filter(e=>e.isAlive()),t=this.party.filter(e=>!e.KO);if(0===e.length||0===t.length)return void this.checkBattleEnd();let i=0;const a=setInterval(()=>{if(i>=e.length)return clearInterval(a),this.party.forEach(e=>e.defending=!1),void(this.battleState="player-turn");const s=e[i],n=t[Math.floor(Math.random()*t.length)];if(n&&!n.KO){let e=s.attack(n);n.defending&&(e=Math.floor(.5*e),n.health+=Math.floor(.5*e),console.log(`${n.job} defended and reduced damage!`))}i++},1e3)}checkBattleEnd(){const e=this.enemies.filter(e=>e.isAlive()),t=this.party.filter(e=>!e.KO&&e.health>0);return 0===e.length?(this.battleState="victory",console.log("Victory! All enemies defeated!"),this.showVictoryScreen(),!0):0===t.length&&(this.battleState="defeat",console.log("Defeat! All party members have fallen!"),this.showDefeatScreen(),!0)}showVictoryScreen(){setTimeout(()=>{alert("Victory! You defeated all enemies!"),this.resetBattle()},1e3)}showDefeatScreen(){setTimeout(()=>{alert("Defeat! Game Over!"),this.resetBattle()},1e3)}resetBattle(){this.party.forEach(e=>{e.health=e.maxHealth,e.KO=!1,e.defending=!1}),this.enemies=[],this.addEnemy(),this.currentCharIndex=0,this.battleState="player-turn",this.actionInProgress=!1}addEnemy(){const e=Math.floor(4*Math.random())+1;for(let t=0;t<e;t++){const e=new n(this.ctx,t);this.enemies.push(e)}}charIndexIncrease(){do{this.currentCharIndex>=3?this.currentCharIndex=0:this.currentCharIndex++}while(this.party[this.currentCharIndex]&&this.party[this.currentCharIndex].KO)}}class o{constructor(e){this.menu=e}start(){console.log(this.menu),this.menu}}class c{constructor(e,t,i,a){this.menu=e,this.game=t,this.tutorial=i,this.ctx=a.getContext("2d"),this.menuCtx=a.getContext("2d"),this.lastTime=0,this.title=document.getElementById("title-screen-text-wrapper"),this.time=0}start(){const e=document.getElementById("menu");e.addEventListener("mouseover",this.menu.selectMouseOver),e.addEventListener("click",e=>{this.selectEventCallback(e)}),document.addEventListener("keydown",e=>{this.selectEventCallback(e)})}selectEventCallback(e){const t=document.getElementById("menu");if(13!=e.keyCode||t.classList.contains("none")){if("click"!=e.type)return this.menu.keyPressed(e);this.select(this.menu.selectMouseClick(e))}else this.select(this.menu.keyPressed(e))}select(e){if("Start Game"===e.innerText){const e=document.getElementById("title-audio");this.title.classList.remove("appearing"),this.title.classList.add("disappearing"),e.volume=.3,this.game.ctx=this.ctx,this.title.addEventListener("animationend",()=>{this.title.classList.add("none"),e.pause(),document.getElementById("battleView").classList.remove("none"),this.game.start(this.menu)},{once:!0}),requestAnimationFrame(this.gameAnimate.bind(this))}else if("How To Play"===e.innerText){const e=new Menu("");this.tutorial.start(e)}}gameAnimate(e){this.time++,this.time>17&&(this.game.aniDone&&this.game.frame++,this.time=0,this.game.draw()),this.lastTime=e,requestAnimationFrame(this.gameAnimate.bind(this))}}class l{constructor(){this.saveKey="first_reality_save_v2",this.defaultSave={version:"2.0.0",timestamp:Date.now(),player:{name:"Hero",level:1,experience:0,gold:100,playtime:0},party:[{name:"Knight",job:"Knight",level:1,experience:0,maxHealth:100,health:100,attack:25,defense:20,magic:5,speed:15,equipment:{weapon:"Iron Sword",armor:"Leather Armor",accessory:null},skills:["Slash","Guard"]},{name:"Cleric",job:"Cleric",level:1,experience:0,maxHealth:80,health:80,attack:15,defense:15,magic:30,speed:12,equipment:{weapon:"Oak Staff",armor:"Robe",accessory:null},skills:["Heal","Bless"]},{name:"Archer",job:"Archer",level:1,experience:0,maxHealth:90,health:90,attack:20,defense:12,magic:10,speed:25,equipment:{weapon:"Short Bow",armor:"Leather Vest",accessory:null},skills:["Arrow Shot","Aim"]},{name:"Wizard",job:"Wizard",level:1,experience:0,maxHealth:70,health:70,attack:10,defense:8,magic:35,speed:18,equipment:{weapon:"Magic Wand",armor:"Mage Robe",accessory:null},skills:["Fire","Lightning"]}],inventory:{items:[{name:"Potion",quantity:5,type:"healing",value:50},{name:"Ether",quantity:3,type:"mana",value:30}],weapons:[],armor:[],accessories:[]},progress:{currentWave:1,battlesWon:0,enemiesDefeated:0,achievements:[],unlockedFeatures:[]},settings:{volume:30,sfxVolume:50,difficulty:"normal",autoSave:!0,showDamageNumbers:!0,animationSpeed:"normal"},statistics:{totalPlaytime:0,totalBattles:0,totalDamageDealt:0,totalDamageReceived:0,highestDamage:0,itemsUsed:0,magicCast:0}}}saveGame(e){try{const t={...this.defaultSave,...e,timestamp:Date.now(),version:"2.0.0"};return localStorage.setItem(this.saveKey,JSON.stringify(t)),this.createBackup(t),console.log("‚úÖ Game saved successfully!"),this.showSaveNotification("Game Saved!","success"),!0}catch(e){return console.error("‚ùå Failed to save game:",e),this.showSaveNotification("Save Failed!","error"),!1}}loadGame(){try{const e=localStorage.getItem(this.saveKey);if(!e)return console.log("üìù No save data found, starting new game"),this.defaultSave;const t=JSON.parse(e);return"2.0.0"!==t.version?(console.log("üîÑ Migrating save data..."),this.migrateSave(t)):(console.log("‚úÖ Game loaded successfully!"),this.showSaveNotification("Game Loaded!","success"),t)}catch(e){return console.error("‚ùå Failed to load game:",e),this.showSaveNotification("Load Failed! Starting new game.","warning"),this.defaultSave}}createBackup(e){try{const t=this.saveKey+"_backup";localStorage.setItem(t,JSON.stringify(e))}catch(e){console.warn("‚ö†Ô∏è Failed to create backup:",e)}}loadBackup(){try{const e=this.saveKey+"_backup",t=localStorage.getItem(e);if(t)return console.log("üîÑ Loading backup save..."),JSON.parse(t)}catch(e){console.error("‚ùå Failed to load backup:",e)}return this.defaultSave}migrateSave(e){console.log("üîÑ Migrating save from version",e.version||"1.0.0");const t={...this.defaultSave,...e,version:"2.0.0",timestamp:Date.now()};return this.saveGame(t),t}deleteSave(){try{return localStorage.removeItem(this.saveKey),localStorage.removeItem(this.saveKey+"_backup"),console.log("üóëÔ∏è Save data deleted"),this.showSaveNotification("Save Deleted!","info"),!0}catch(e){return console.error("‚ùå Failed to delete save:",e),!1}}hasSaveData(){return null!==localStorage.getItem(this.saveKey)}exportSave(){try{const e=this.loadGame(),t=JSON.stringify(e,null,2),i=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(i),s=document.createElement("a");return s.href=a,s.download=`first_reality_save_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a),this.showSaveNotification("Save Exported!","success"),!0}catch(e){return console.error("‚ùå Failed to export save:",e),this.showSaveNotification("Export Failed!","error"),!1}}importSave(e){return new Promise((t,i)=>{const a=new FileReader;a.onload=e=>{try{const i=JSON.parse(e.target.result);if(!this.validateSave(i))throw new Error("Invalid save file format");this.saveGame(i),this.showSaveNotification("Save Imported!","success"),t(i)}catch(e){console.error("‚ùå Failed to import save:",e),this.showSaveNotification("Import Failed!","error"),i(e)}},a.readAsText(e)})}validateSave(e){return["player","party","inventory","progress"].every(t=>e.hasOwnProperty(t))}setupAutoSave(e,t=6e4){this.autoSaveInterval&&clearInterval(this.autoSaveInterval),this.autoSaveInterval=setInterval(()=>{if(e&&e.getGameData){const t=e.getGameData();t.settings&&!1!==t.settings.autoSave&&this.saveGame(t)}},t)}showSaveNotification(e,t="info"){const i=document.createElement("div");i.className=`save-notification save-${t}`,i.textContent=e,Object.assign(i.style,{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",background:"success"===t?"#4CAF50":"error"===t?"#f44336":"warning"===t?"#ff9800":"#2196F3",color:"white",padding:"12px 24px",borderRadius:"8px",fontFamily:"Final Fantasy, monospace",fontSize:"14px",fontWeight:"bold",zIndex:"10000",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",animation:"slideInDown 0.3s ease-out"}),document.body.appendChild(i),setTimeout(()=>{i.style.animation="slideOutUp 0.3s ease-in",setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300)},3e3)}getSaveStats(){const e=this.loadGame();return{saveExists:this.hasSaveData(),playerLevel:e.player?e.player.level:1,playtime:this.formatPlaytime(e.statistics&&e.statistics.totalPlaytime||0),battlesWon:e.progress&&e.progress.battlesWon||0,lastSaved:new Date(e.timestamp||Date.now()).toLocaleString()}}formatPlaytime(e){const t=Math.floor(e/36e5),i=Math.floor(e%36e5/6e4),a=Math.floor(e%6e4/1e3);return t>0?`${t}h ${i}m ${a}s`:i>0?`${i}m ${a}s`:`${a}s`}destroy(){this.autoSaveInterval&&clearInterval(this.autoSaveInterval)}}class h{constructor(){this.audioContext=null,this.masterVolume=.3,this.musicVolume=.5,this.sfxVolume=.7,this.isMuted=!0,this.sounds=new Map,this.music=new Map,this.currentMusic=null,this.fadeInterval=null,this.initializeAudioContext(),this.createSoundEffects()}initializeAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.masterGain.gain.value=this.masterVolume,this.musicGain=this.audioContext.createGain(),this.musicGain.connect(this.masterGain),this.musicGain.gain.value=this.musicVolume,this.sfxGain=this.audioContext.createGain(),this.sfxGain.connect(this.masterGain),this.sfxGain.gain.value=this.sfxVolume,console.log("üéµ Audio Context initialized")}catch(e){console.warn("‚ö†Ô∏è Web Audio API not supported, falling back to HTML5 audio")}}createSoundEffects(){this.sounds.set("sword_slash",this.createSwordSlash),this.sounds.set("magic_cast",this.createMagicCast),this.sounds.set("bow_shot",this.createBowShot),this.sounds.set("staff_hit",this.createStaffHit),this.sounds.set("menu_select",this.createMenuSelect),this.sounds.set("menu_confirm",this.createMenuConfirm),this.sounds.set("menu_cancel",this.createMenuCancel),this.sounds.set("enemy_hit",this.createEnemyHit),this.sounds.set("critical_hit",this.createCriticalHit),this.sounds.set("heal",this.createHealSound),this.sounds.set("level_up",this.createLevelUp),this.sounds.set("victory",this.createVictory),this.sounds.set("defeat",this.createDefeat),this.sounds.set("footstep",this.createFootstep),this.sounds.set("door_open",this.createDoorOpen),this.sounds.set("item_get",this.createItemGet)}playSound(e,t=1,i=1){if(this.isMuted||!this.audioContext)return;const a=this.sounds.get(e);if(a)try{a.call(this,t,i)}catch(t){console.warn(`Failed to play sound: ${e}`,t)}}createSwordSlash(e=1,t=1){const i=this.audioContext.createOscillator(),a=this.audioContext.createGain(),s=this.audioContext.createBiquadFilter();i.connect(s),s.connect(a),a.connect(this.sfxGain),i.type="sawtooth",i.frequency.setValueAtTime(200*t,this.audioContext.currentTime),i.frequency.exponentialRampToValueAtTime(100*t,this.audioContext.currentTime+.3),s.type="lowpass",s.frequency.setValueAtTime(2e3,this.audioContext.currentTime),s.frequency.exponentialRampToValueAtTime(500,this.audioContext.currentTime+.3),a.gain.setValueAtTime(.3*e,this.audioContext.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+.3)}createMagicCast(e=1,t=1){for(let i=0;i<3;i++){const a=this.audioContext.createOscillator(),s=this.audioContext.createGain(),n=this.audioContext.createDelay();a.connect(n),n.connect(s),s.connect(this.sfxGain),a.type="sine",a.frequency.setValueAtTime((440+110*i)*t,this.audioContext.currentTime),a.frequency.linearRampToValueAtTime((880+220*i)*t,this.audioContext.currentTime+.8),n.delayTime.value=.05*i,s.gain.setValueAtTime(.2*e,this.audioContext.currentTime+.1*i),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.8),a.start(this.audioContext.currentTime+.1*i),a.stop(this.audioContext.currentTime+.8)}}createBowShot(e=1,t=1){const i=this.audioContext.createOscillator(),a=this.audioContext.createGain(),s=this.audioContext.createBiquadFilter();i.connect(s),s.connect(a),a.connect(this.sfxGain),i.type="triangle",i.frequency.setValueAtTime(800*t,this.audioContext.currentTime),i.frequency.exponentialRampToValueAtTime(200*t,this.audioContext.currentTime+.2),s.type="bandpass",s.frequency.value=1e3,s.Q.value=5,a.gain.setValueAtTime(.4*e,this.audioContext.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.2),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+.2)}createMenuSelect(e=1,t=1){const i=this.audioContext.createOscillator(),a=this.audioContext.createGain();i.connect(a),a.connect(this.sfxGain),i.type="square",i.frequency.value=800*t,a.gain.setValueAtTime(.2*e,this.audioContext.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+.1)}createCriticalHit(e=1,t=1){for(let i=0;i<5;i++){const a=this.audioContext.createOscillator(),s=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();a.connect(n),n.connect(s),s.connect(this.sfxGain),a.type=i%2==0?"sawtooth":"square",a.frequency.setValueAtTime((300+100*i)*t,this.audioContext.currentTime),a.frequency.exponentialRampToValueAtTime((150+50*i)*t,this.audioContext.currentTime+.5),n.type="lowpass",n.frequency.setValueAtTime(3e3,this.audioContext.currentTime),n.frequency.exponentialRampToValueAtTime(800,this.audioContext.currentTime+.5),s.gain.setValueAtTime(.15*e,this.audioContext.currentTime+.02*i),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),a.start(this.audioContext.currentTime+.02*i),a.stop(this.audioContext.currentTime+.5)}}createHealSound(e=1,t=1){for(let i=0;i<4;i++){const a=this.audioContext.createOscillator(),s=this.audioContext.createGain();a.connect(s),s.connect(this.sfxGain),a.type="sine",a.frequency.setValueAtTime((440+110*i)*t,this.audioContext.currentTime+.1*i),s.gain.setValueAtTime(0,this.audioContext.currentTime+.1*i),s.gain.linearRampToValueAtTime(.15*e,this.audioContext.currentTime+.1*i+.05),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.6),a.start(this.audioContext.currentTime+.1*i),a.stop(this.audioContext.currentTime+.6)}}createLevelUp(e=1,t=1){[261.63,329.63,392,523.25].forEach((i,a)=>{const s=this.audioContext.createOscillator(),n=this.audioContext.createGain();s.connect(n),n.connect(this.sfxGain),s.type="triangle",s.frequency.value=i*t,n.gain.setValueAtTime(0,this.audioContext.currentTime+.2*a),n.gain.linearRampToValueAtTime(.2*e,this.audioContext.currentTime+.2*a+.1),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+1.2),s.start(this.audioContext.currentTime+.2*a),s.stop(this.audioContext.currentTime+1.2)})}setMasterVolume(e){this.masterVolume=Math.max(0,Math.min(1,e)),this.masterGain&&(this.masterGain.gain.value=this.isMuted?0:this.masterVolume)}setMusicVolume(e){this.musicVolume=Math.max(0,Math.min(1,e)),this.musicGain&&(this.musicGain.gain.value=this.musicVolume)}setSFXVolume(e){this.sfxVolume=Math.max(0,Math.min(1,e)),this.sfxGain&&(this.sfxGain.gain.value=this.sfxVolume)}setMuted(e){this.isMuted=e,this.masterGain&&(this.masterGain.gain.value=e?0:this.masterVolume)}playMusic(e,t=1){if(this.isMuted)return;this.currentMusic&&this.currentMusic!==e&&this.fadeOutMusic(this.currentMusic,.5),this.currentMusic=e,e.volume=0,e.currentTime=0;const i=e.play();i&&i.then(()=>{this.fadeInMusic(e,t)}).catch(e=>{console.warn("Music play failed:",e)})}fadeInMusic(e,t){const i=this.masterVolume*this.musicVolume,a=1e3*t/60,s=i/60;let n=0;this.fadeInterval=setInterval(()=>{n++,e.volume=Math.min(s*n,i),n>=60&&clearInterval(this.fadeInterval)},a)}fadeOutMusic(e,t){const i=e.volume,a=i/60;let s=0;const n=setInterval(()=>{s++,e.volume=Math.max(i-a*s,0),(s>=60||e.volume<=0)&&(clearInterval(n),e.pause())},1e3*t/60)}resumeAudioContext(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume().then(()=>{console.log("üéµ Audio Context resumed")})}getAudioState(){return{supported:!!this.audioContext,state:this.audioContext?this.audioContext.state:"unavailable",masterVolume:this.masterVolume,musicVolume:this.musicVolume,sfxVolume:this.sfxVolume,isMuted:this.isMuted}}destroy(){this.fadeInterval&&clearInterval(this.fadeInterval),this.currentMusic&&this.currentMusic.pause(),this.audioContext&&this.audioContext.close()}createStaffHit(e=1,t=1){this.createSwordSlash(.8*e,.7*t)}createMenuConfirm(e=1,t=1){const i=this.audioContext.createOscillator(),a=this.audioContext.createGain();i.connect(a),a.connect(this.sfxGain),i.type="square",i.frequency.setValueAtTime(600*t,this.audioContext.currentTime),i.frequency.linearRampToValueAtTime(800*t,this.audioContext.currentTime+.15),a.gain.setValueAtTime(.25*e,this.audioContext.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+.15)}createMenuCancel(e=1,t=1){const i=this.audioContext.createOscillator(),a=this.audioContext.createGain();i.connect(a),a.connect(this.sfxGain),i.type="square",i.frequency.setValueAtTime(400*t,this.audioContext.currentTime),i.frequency.linearRampToValueAtTime(200*t,this.audioContext.currentTime+.2),a.gain.setValueAtTime(.2*e,this.audioContext.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.2),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+.2)}createEnemyHit(e=1,t=1){this.createSwordSlash(e,.6*t)}createVictory(e=1,t=1){[261.63,329.63,392,523.25,659.25].forEach((i,a)=>{const s=this.audioContext.createOscillator(),n=this.audioContext.createGain();s.connect(n),n.connect(this.sfxGain),s.type="triangle",s.frequency.value=i*t,n.gain.setValueAtTime(0,this.audioContext.currentTime+.3*a),n.gain.linearRampToValueAtTime(.2*e,this.audioContext.currentTime+.3*a+.1),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+2),s.start(this.audioContext.currentTime+.3*a),s.stop(this.audioContext.currentTime+2)})}createDefeat(e=1,t=1){const i=this.audioContext.createOscillator(),a=this.audioContext.createGain();i.connect(a),a.connect(this.sfxGain),i.type="sine",i.frequency.setValueAtTime(220*t,this.audioContext.currentTime),i.frequency.exponentialRampToValueAtTime(110*t,this.audioContext.currentTime+1.5),a.gain.setValueAtTime(.3*e,this.audioContext.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+1.5),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+1.5)}createFootstep(e=1,t=1){const i=this.audioContext.createOscillator(),a=this.audioContext.createGain(),s=this.audioContext.createBiquadFilter();i.connect(s),s.connect(a),a.connect(this.sfxGain),i.type="brown",s.type="lowpass",s.frequency.value=200,a.gain.setValueAtTime(.1*e,this.audioContext.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+.1)}createDoorOpen(e=1,t=1){const i=this.audioContext.createOscillator(),a=this.audioContext.createGain();i.connect(a),a.connect(this.sfxGain),i.type="sawtooth",i.frequency.setValueAtTime(150*t,this.audioContext.currentTime),i.frequency.linearRampToValueAtTime(200*t,this.audioContext.currentTime+.8),a.gain.setValueAtTime(.15*e,this.audioContext.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.8),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+.8)}createItemGet(e=1,t=1){[523.25,659.25,783.99].forEach((i,a)=>{const s=this.audioContext.createOscillator(),n=this.audioContext.createGain();s.connect(n),n.connect(this.sfxGain),s.type="sine",s.frequency.value=i*t,n.gain.setValueAtTime(0,this.audioContext.currentTime+.1*a),n.gain.linearRampToValueAtTime(.2*e,this.audioContext.currentTime+.1*a+.05),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),s.start(this.audioContext.currentTime+.1*a),s.stop(this.audioContext.currentTime+.5)})}}class u{constructor(){this.experienceTable=this.generateExperienceTable(),this.skillTrees=this.createSkillTrees(),this.equipment=this.createEquipmentDatabase(),this.achievements=this.createAchievements()}generateExperienceTable(){const e=[0];for(let t=2;t<=99;t++){const i=Math.floor(100*Math.pow(t,1.8));e.push(i)}return e}createSkillTrees(){return{Knight:{name:"Knight",skills:{"Power Strike":{id:"power_strike",name:"Power Strike",description:"Deal 150% weapon damage",type:"offensive",mpCost:8,levelRequired:3,prerequisites:[],effect:{damageMultiplier:1.5}},Whirlwind:{id:"whirlwind",name:"Whirlwind",description:"Attack all enemies for 80% damage",type:"offensive",mpCost:15,levelRequired:7,prerequisites:["power_strike"],effect:{damageMultiplier:.8,target:"all_enemies"}},"Berserker Rage":{id:"berserker_rage",name:"Berserker Rage",description:"Double attack power for 3 turns, take 25% more damage",type:"buff",mpCost:20,levelRequired:12,prerequisites:["whirlwind"],effect:{attackBoost:2,defenseReduction:.25,duration:3}},"Shield Wall":{id:"shield_wall",name:"Shield Wall",description:"Reduce all damage by 50% for 2 turns",type:"defensive",mpCost:12,levelRequired:5,prerequisites:[],effect:{damageReduction:.5,duration:2}},Taunt:{id:"taunt",name:"Taunt",description:"Force all enemies to target you for 2 turns",type:"defensive",mpCost:8,levelRequired:4,prerequisites:[],effect:{forceTaunt:!0,duration:2}},Guardian:{id:"guardian",name:"Guardian",description:"Take 50% of damage dealt to allies",type:"defensive",mpCost:18,levelRequired:10,prerequisites:["shield_wall","taunt"],effect:{damageRedirect:.5,duration:4}}}},Cleric:{name:"Cleric",skills:{"Minor Heal":{id:"minor_heal",name:"Minor Heal",description:"Restore 40-60 HP to one ally",type:"healing",mpCost:6,levelRequired:2,prerequisites:[],effect:{healAmount:[40,60],target:"single_ally"}},"Major Heal":{id:"major_heal",name:"Major Heal",description:"Restore 80-120 HP to one ally",type:"healing",mpCost:15,levelRequired:6,prerequisites:["minor_heal"],effect:{healAmount:[80,120],target:"single_ally"}},"Group Heal":{id:"group_heal",name:"Group Heal",description:"Restore 30-50 HP to all allies",type:"healing",mpCost:25,levelRequired:9,prerequisites:["major_heal"],effect:{healAmount:[30,50],target:"all_allies"}},Resurrection:{id:"resurrection",name:"Resurrection",description:"Revive fallen ally with 25% HP",type:"healing",mpCost:40,levelRequired:15,prerequisites:["group_heal"],effect:{revive:!0,hpPercent:.25}},Bless:{id:"bless",name:"Bless",description:"Increase ally attack and defense by 25% for 4 turns",type:"buff",mpCost:10,levelRequired:4,prerequisites:[],effect:{attackBoost:1.25,defenseBoost:1.25,duration:4}},"Holy Light":{id:"holy_light",name:"Holy Light",description:"Deal magic damage to all undead enemies",type:"offensive",mpCost:18,levelRequired:8,prerequisites:["bless"],effect:{damageMultiplier:2,target:"undead_enemies"}}}},Archer:{name:"Archer",skills:{"Aimed Shot":{id:"aimed_shot",name:"Aimed Shot",description:"High accuracy shot with 25% critical chance",type:"offensive",mpCost:8,levelRequired:3,prerequisites:[],effect:{accuracy:1.5,criticalChance:.25}},"Multi Shot":{id:"multi_shot",name:"Multi Shot",description:"Fire arrows at 3 random enemies",type:"offensive",mpCost:15,levelRequired:6,prerequisites:["aimed_shot"],effect:{shots:3,target:"random_enemies"}},"Rain of Arrows":{id:"rain_of_arrows",name:"Rain of Arrows",description:"Attack all enemies with reduced damage",type:"offensive",mpCost:22,levelRequired:10,prerequisites:["multi_shot"],effect:{damageMultiplier:.7,target:"all_enemies"}},"Eagle Eye":{id:"eagle_eye",name:"Eagle Eye",description:"Increase accuracy and critical rate for 3 turns",type:"buff",mpCost:12,levelRequired:5,prerequisites:[],effect:{accuracyBoost:1.5,criticalBoost:.3,duration:3}},"Poison Arrow":{id:"poison_arrow",name:"Poison Arrow",description:"Arrow that deals poison damage over 3 turns",type:"offensive",mpCost:10,levelRequired:7,prerequisites:["eagle_eye"],effect:{poisonDamage:15,duration:3}}}},Wizard:{name:"Wizard",skills:{Fireball:{id:"fireball",name:"Fireball",description:"Deal fire damage to one enemy",type:"offensive",mpCost:10,levelRequired:2,prerequisites:[],effect:{element:"fire",damageMultiplier:1.3}},"Lightning Bolt":{id:"lightning_bolt",name:"Lightning Bolt",description:"Deal lightning damage to one enemy",type:"offensive",mpCost:12,levelRequired:3,prerequisites:[],effect:{element:"lightning",damageMultiplier:1.2,stunChance:.2}},"Ice Shard":{id:"ice_shard",name:"Ice Shard",description:"Deal ice damage and slow enemy",type:"offensive",mpCost:11,levelRequired:3,prerequisites:[],effect:{element:"ice",damageMultiplier:1.1,slowEffect:.3}},Meteor:{id:"meteor",name:"Meteor",description:"Devastating fire damage to all enemies",type:"offensive",mpCost:35,levelRequired:12,prerequisites:["fireball","lightning_bolt","ice_shard"],effect:{element:"fire",damageMultiplier:1.8,target:"all_enemies"}},"Mana Shield":{id:"mana_shield",name:"Mana Shield",description:"Convert damage to MP loss instead of HP",type:"defensive",mpCost:20,levelRequired:8,prerequisites:[],effect:{manaShield:!0,duration:5}},"Arcane Intellect":{id:"arcane_intellect",name:"Arcane Intellect",description:"Increase magic power and MP regeneration",type:"buff",mpCost:15,levelRequired:6,prerequisites:[],effect:{magicBoost:1.4,mpRegen:5,duration:6}}}}}}createEquipmentDatabase(){return{weapons:{"Iron Sword":{id:"iron_sword",name:"Iron Sword",type:"weapon",class:"Knight",attack:15,price:200,description:"A sturdy iron blade"},"Steel Sword":{id:"steel_sword",name:"Steel Sword",type:"weapon",class:"Knight",attack:25,price:500,description:"Sharp steel forged blade"},Excalibur:{id:"excalibur",name:"Excalibur",type:"weapon",class:"Knight",attack:50,price:5e3,description:"Legendary holy sword",special:{holyDamage:10,criticalRate:.15}},"Oak Staff":{id:"oak_staff",name:"Oak Staff",type:"weapon",class:"Cleric",attack:8,magic:12,price:150,description:"Simple wooden staff"},"Crystal Staff":{id:"crystal_staff",name:"Crystal Staff",type:"weapon",class:"Cleric",attack:12,magic:25,price:800,description:"Staff topped with healing crystal"},"Short Bow":{id:"short_bow",name:"Short Bow",type:"weapon",class:"Archer",attack:12,speed:5,price:180,description:"Quick and accurate bow"},"Elven Bow":{id:"elven_bow",name:"Elven Bow",type:"weapon",class:"Archer",attack:30,speed:10,price:1200,description:"Masterwork elven craftsmanship"},"Magic Wand":{id:"magic_wand",name:"Magic Wand",type:"weapon",class:"Wizard",attack:5,magic:15,price:120,description:"Basic spellcasting focus"},"Arcane Staff":{id:"arcane_staff",name:"Arcane Staff",type:"weapon",class:"Wizard",attack:10,magic:35,price:1500,description:"Staff humming with arcane power"}},armor:{"Leather Armor":{id:"leather_armor",name:"Leather Armor",type:"armor",defense:8,price:150,description:"Basic leather protection"},"Chain Mail":{id:"chain_mail",name:"Chain Mail",type:"armor",defense:15,price:400,description:"Interlocked metal rings"},"Plate Armor":{id:"plate_armor",name:"Plate Armor",type:"armor",defense:25,price:1e3,description:"Heavy metal plate protection"},"Dragon Scale":{id:"dragon_scale",name:"Dragon Scale Armor",type:"armor",defense:40,price:5e3,description:"Armor made from dragon scales",special:{fireResistance:.5,magicDefense:10}}},accessories:{"Power Ring":{id:"power_ring",name:"Power Ring",type:"accessory",attack:5,price:300,description:"Ring that enhances physical strength"},"Magic Ring":{id:"magic_ring",name:"Magic Ring",type:"accessory",magic:8,price:350,description:"Ring that amplifies magical power"},"Life Amulet":{id:"life_amulet",name:"Life Amulet",type:"accessory",maxHealth:25,price:500,description:"Amulet that increases vitality"},"Speed Boots":{id:"speed_boots",name:"Speed Boots",type:"accessory",speed:10,price:400,description:"Boots that increase movement speed"}}}}createAchievements(){return{first_victory:{id:"first_victory",name:"First Victory",description:"Win your first battle",icon:"üèÜ",reward:{experience:50,gold:100}},level_10:{id:"level_10",name:"Veteran",description:"Reach level 10 with any character",icon:"‚≠ê",reward:{gold:500,item:"Power Ring"}},perfect_battle:{id:"perfect_battle",name:"Perfect Victory",description:"Win a battle without taking damage",icon:"üíé",reward:{experience:100,gold:200}},magic_master:{id:"magic_master",name:"Magic Master",description:"Cast 100 spells",icon:"üîÆ",reward:{item:"Magic Ring",gold:300}},treasure_hunter:{id:"treasure_hunter",name:"Treasure Hunter",description:"Collect 10 different items",icon:"üí∞",reward:{gold:1e3}}}}getExperienceToNextLevel(e,t){return e>=99?0:this.experienceTable[e]-t}getLevelFromExperience(e){for(let t=1;t<this.experienceTable.length;t++)if(e<this.experienceTable[t])return t;return 99}levelUpCharacter(e){const t=e.level,i=this.getLevelFromExperience(e.experience);if(i>t){e.level=i;const a=i-t,s=this.calculateStatGains(e.job,a);e.maxHealth+=s.health,e.health=e.maxHealth,e.attack+=s.attack,e.defense+=s.defense,e.magic+=s.magic,e.speed+=s.speed;const n=this.getNewSkills(e.job,i);return e.skills=[...e.skills,...n],console.log(`üéâ ${e.name} reached level ${i}!`),{leveledUp:!0,oldLevel:t,newLevel:i,statGains:s,newSkills:n}}return{leveledUp:!1}}calculateStatGains(e,t){const i={Knight:{health:8,attack:3,defense:3,magic:1,speed:1},Cleric:{health:5,attack:2,defense:2,magic:4,speed:1},Archer:{health:6,attack:3,defense:2,magic:2,speed:3},Wizard:{health:4,attack:1,defense:1,magic:5,speed:2}},a=i[e]||i.Knight;return{health:a.health*t,attack:a.attack*t,defense:a.defense*t,magic:a.magic*t,speed:a.speed*t}}getNewSkills(e,t){const i=this.skillTrees[e];if(!i)return[];const a=[];return Object.values(i.skills).forEach(e=>{e.levelRequired===t&&a.push(e.id)}),a}canLearnSkill(e,t){const i=this.skillTrees[e.job];if(!i)return!1;const a=i.skills[Object.keys(i.skills).find(e=>i.skills[e].id===t)];return!!a&&(!(e.level<a.levelRequired)&&(!e.skills.includes(t)&&a.prerequisites.every(t=>e.skills.includes(t))))}applyEquipmentStats(e){let t={attack:0,defense:0,magic:0,speed:0,maxHealth:0};if(e.equipment.weapon){const i=this.equipment.weapons[e.equipment.weapon];i&&(t.attack+=i.attack||0,t.magic+=i.magic||0,t.speed+=i.speed||0)}if(e.equipment.armor){const i=this.equipment.armor[e.equipment.armor];i&&(t.defense+=i.defense||0,t.maxHealth+=i.maxHealth||0)}if(e.equipment.accessory){const i=this.equipment.accessories[e.equipment.accessory];i&&(t.attack+=i.attack||0,t.defense+=i.defense||0,t.magic+=i.magic||0,t.speed+=i.speed||0,t.maxHealth+=i.maxHealth||0)}return t}checkAchievements(e,t){const i=[];return Object.values(this.achievements).forEach(a=>{if(e.progress.achievements.includes(a.id))return;let s=!1;switch(a.id){case"first_victory":s=e.progress.battlesWon>=1;break;case"level_10":s=e.party.some(e=>e.level>=10);break;case"perfect_battle":s="perfect_victory"===t;break;case"magic_master":s=e.statistics.magicCast>=100;break;case"treasure_hunter":s=e.inventory.items.length+e.inventory.weapons.length+e.inventory.armor.length+e.inventory.accessories.length>=10}if(s&&(i.push(a),e.progress.achievements.push(a.id),a.reward.experience&&e.party.forEach(e=>{e.experience+=a.reward.experience}),a.reward.gold&&(e.player.gold+=a.reward.gold),a.reward.item)){const t=e.inventory.items.find(e=>e.name===a.reward.item);t?t.quantity+=1:e.inventory.items.push({name:a.reward.item,quantity:1})}}),i}getEffectiveStats(e){const t=this.applyEquipmentStats(e);return{maxHealth:e.maxHealth+t.maxHealth,attack:e.attack+t.attack,defense:e.defense+t.defense,magic:e.magic+t.magic,speed:e.speed+t.speed}}getAvailableSkills(e){const t=this.skillTrees[e.job];return t?Object.values(t.skills).filter(t=>this.canLearnSkill(e,t.id)):[]}getSkillInfo(e,t){const i=this.skillTrees[e];return i?Object.values(i.skills).find(e=>e.id===t):null}}document.addEventListener("DOMContentLoaded",()=>{const e=new l,t=new h,i=new u,s=new a("#menu li","menu"),n=new o,d=document.getElementById("battle-view"),m=document.getElementById("enemies-ui"),p=document.getElementById("party-ui");d.width=.85*window.innerWidth,d.height=.8*window.innerHeight,m.width=.3*(d.width-50),m.height=window.innerHeight-d.height-50,p.width=.3*(d.width-50),p.height=window.innerHeight-d.height-50;const f=new r(d,{saveSystem:e,soundSystem:t,progression:i}),g=new c(s,f,n,d,m,p,{saveSystem:e,soundSystem:t,progression:i});let v=0,y=!0;if(s.selection(0),y){let e=document.getElementById("press-start");e.addEventListener("animationend",(function(){console.log("remounted"),y=!1,document.body.addEventListener("keydown",(function(t){13==t.keyCode&&(e.classList.remove("title-screen-appearing"),s.cursorSelect.play(),e.classList.add("title-screen-disappear"))}))})),e.addEventListener("animationend",(function(){if(1===(v+=1))return;document.getElementById("title-screen-controller").classList.add("none"),g.start(),document.getElementById("title-screen-menu").classList.remove("none");let e=document.getElementById("title-audio");e.volume=.3,e.play()}))}})}]);
//# sourceMappingURL=bundle.js.map