!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(t,e){this.tokenMenu=0,this.menuId=e,this.cursor=document.createElement("img"),this.cursor.className="selected",this.cursor.src="https://www.dropbox.com/s/1pq4d1ksjv3tuoz/FF7Cursor.png?raw=1",this.divShadow=document.createElement("div"),this.divShadow.className="shadow",this.cursorMove=new Audio,this.cursorMove.src="https://www.dropbox.com/s/fiyx4q2mdwynraj/FF7CursorMove.mp3?raw=1",this.cursorMove.volume=.4,this.cursorSelect=new Audio,this.cursorSelect.src="https://www.dropbox.com/s/v04ewrevpnnsz03/FF7CursorSaveLoad.mp3?raw=1",this.cursorSelect.volume=.4,this.menuItems=document.querySelectorAll(`${t}`),this.selectMouseOver=this.selectMouseOver.bind(this),this.keyPressed=this.keyPressed.bind(this),this.selectMouseClick=this.selectMouseClick.bind(this)}selectMouseOver(t){t.preventDefault(),t.target.parentNode.id==this.menuId&&(this.tokenMenu=parseInt(t.target.getAttribute("number")),this.selection(this.tokenMenu),this.cursorMove.play())}selectMouseClick(t){if(t.preventDefault(),t.target.parentNode.id==this.menuId)return this.tokenMenu=parseInt(t.target.getAttribute("number")),this.cursorSelect.play(),this.menuItems[this.tokenMenu]}keyPressed(t){if(t.preventDefault(),38==t.keyCode)this.tokenMenu>0?this.tokenMenu-=1:this.tokenMenu=1,this.selection(this.tokenMenu),this.cursorMove.play();else if(40==t.keyCode)this.tokenMenu<1?this.tokenMenu+=1:this.tokenMenu=0,this.selection(this.tokenMenu),this.cursorMove.play();else if(13==t.keyCode)return this.cursorSelect.play(),this.menuItems[this.tokenMenu]}selection(t){this.menuItems[t].prepend(this.cursor),this.menuItems[t].prepend(this.divShadow)}select(t){return this.menuItems[t]}}class n{constructor(t,e,s,i){this.level=1,this.maxHealth=100,this.health=this.maxHealth,this.KO=!1,this.job=t,this.ctx=e,this.sprite=s,this.index=i,this.frame=0,this.forward=!1,this.back=!1,this.partyHpUi=document.getElementById("party-ui").getContext("2d"),this.partyHpUi.font="26px Final Fantasy",this.spriteHeight(i),this.canvasX=.85*this.ctx.canvas.width,this.canvasY=this.ctx.canvas.height*this.heightFloat+.3*this.ctx.canvas.height}isOdd(t){return 1==Math.abs(t%2)}draw(t){this.forward&&this.frame<=9?this.walkForward(t):this.back&&this.frame>=1?this.walkBack():this.ctx.drawImage(this.sprite,0,0,64,64,this.canvasX,this.canvasY,125,125),this.partyHpUi.clearRect(0,this.index*(this.partyHpUi.canvas.height/4),this.partyHpUi.canvas.width,this.partyHpUi.canvas.height),this.partyHpUi.fillText(this.job,25,(this.index+1)*(this.partyHpUi.canvas.height/4)),this.partyHpUi.fillText(`${this.health} / ${this.maxHealth}`,this.partyHpUi.canvas.width-125,(this.index+1)*(this.partyHpUi.canvas.height/4))}walkForward(t){this.frame++,this.isOdd(this.frame)?this.ctx.drawImage(this.sprite,64,0,64,64,this.canvasX-=parseInt(this.frame+"0"),this.canvasY,125,125):this.frame<=9&&this.ctx.drawImage(this.sprite,0,0,64,64,this.canvasX-=parseInt(this.frame+"0"),this.canvasY,125,125),10==this.frame&&t()}walkBack(){this.frame--,this.isOdd(this.frame)?this.ctx.drawImage(this.sprite,64,0,64,64,this.canvasX+=parseInt(this.frame+"0"),this.canvasY,125,125):this.frame>=1&&this.ctx.drawImage(this.sprite,0,0,64,64,this.canvasX+=parseInt(this.frame+"0"),this.canvasY,125,125)}attack(t){if(t.health<=0)return void console.log("Monster is already dead!");const e=Math.floor(30*Math.random())+15;t.health-=e,t.health<=0?(t.health=0,t.KO=!0,console.log(`Monster defeated! Dealt ${e} damage.`)):console.log(`Dealt ${e} damage to monster. Monster health: ${t.health}`),this.showDamage(e)}showDamage(t){const e=document.createElement("div");e.textContent=`-${t}`,e.style.position="absolute",e.style.color="#ff4444",e.style.fontSize="24px",e.style.fontWeight="bold",e.style.zIndex="1000",e.style.pointerEvents="none",e.style.left="50%",e.style.top="30%",e.style.transform="translateX(-50%)",e.style.animation="damageFloat 1.5s ease-out forwards",document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},1500)}spriteHeight(t){let e=Number((t+.5*t).toString().replace(".",""));this.heightFloat=parseFloat(`0.${e}`)}}class a{constructor(t,e){this.level=1,this.maxHealth=100,this.health=this.maxHealth,this.KO=!1,this.ctx=t,this.sprite=new Image,this.sprite.src="Final_Fantasy_1_Enemies & Bosses.png",this.index=e,this.frame=0,this.monsterHpUi=document.getElementById("enemies-ui").getContext("2d"),this.monsterHpUi.font="26px Final Fantasy",this.spriteHeight(e),this.canvasX=this.ctx.canvas.width/8,this.canvasY=this.ctx.canvas.height*this.heightFloat+this.ctx.canvas.height/3.5,this.smallMonsters=[[0,0,36,64]],this.medMonsters=[]}draw(){!this.KO&&this.health>0?this.ctx.drawImage(this.sprite,...this.smallMonsters[0],this.canvasX,this.canvasY,125,200):(this.ctx.save(),this.ctx.globalAlpha=.3,this.ctx.drawImage(this.sprite,...this.smallMonsters[0],this.canvasX,this.canvasY,125,200),this.ctx.restore()),this.monsterHpUi.clearRect(0,this.index*(this.monsterHpUi.canvas.height/4),this.monsterHpUi.canvas.width,this.monsterHpUi.canvas.height);const t=this.health/this.maxHealth;this.monsterHpUi.fillStyle=t>.6?"#00ff00":t>.3?"#ffff00":"#ff0000",this.monsterHpUi.fillText(`Monster ${this.index+1}`,25,(this.index+1)*(this.monsterHpUi.canvas.height/4)),this.monsterHpUi.fillText(`${this.health} / ${this.maxHealth}`,this.monsterHpUi.canvas.width-125,(this.index+1)*(this.monsterHpUi.canvas.height/4)),this.monsterHpUi.fillStyle="#ffffff"}death(){this.KO=!0,this.health=0,console.log(`Monster ${this.index+1} has been defeated!`)}attack(t){if(this.KO||this.health<=0)return;const e=Math.floor(20*Math.random())+10;return t.health-=e,t.health<=0?(t.health=0,t.KO=!0,console.log(`${t.job} has been defeated! Monster dealt ${e} damage.`)):console.log(`Monster dealt ${e} damage to ${t.job}. ${t.job} health: ${t.health}`),e}isAlive(){return!this.KO&&this.health>0}spriteHeight(t){let e=Number((t+.5*t).toString().replace(".",""));this.heightFloat=parseFloat(`0.${e}`)}}class r{constructor(t){this.party=[],this.enemies=[],this.wave=0,this.currentChar=null,this.currentCharIndex=0,this.ctx=t,this.frame=0,this.aniDone=!1,this.partyMenu=new i("#party-moves li","party-moves"),this.wave=0,this.battleState="player-turn",this.turnQueue=[],this.currentTurn=0,this.actionInProgress=!1,this.draw=this.draw.bind(this),this.charIndexIncrease=this.charIndexIncrease.bind(this)}draw(){this.currentChar=this.party[this.currentCharIndex],this.ctx.width=window.innerWidth,this.ctx.height=window.innerHeight,this.ctx.clearRect(0,0,this.ctx.width,this.ctx.height),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.ctx.width,this.ctx.height),this.drawBackground(),this.addSprites(),this.drawMonsters(),document.body.addEventListener("animationend",()=>{document.body.style.backgroundColor="black",this.aniDone=!0,this.currentChar&&(this.currentChar.forward=!0)})}start(t){const e=new n("Knight",this.ctx,null,0),s=new n("Cleric",this.ctx,null,1),i=new n("Archer",this.ctx,null,2),a=new n("Wizard",this.ctx,null,3);this.party.push(e,s,i,a),this.addEnemy();const r=document.getElementById("party-moves");r.addEventListener("mouseover",this.partyMenu.selectMouseOver),r.addEventListener("click",t=>{this.partySelectEventCallback(t)}),document.addEventListener("keydown",t=>{this.partySelectEventCallback(t)}),this.partyMenu.selection(0)}partySelectEventCallback(t){const e=document.getElementById("party-moves");if(13!=t.keyCode||e.classList.contains("none")){if("click"!=t.type)return this.partyMenu.keyPressed(t);this.onSelect(this.partyMenu.selectMouseClick(t))}else this.onSelect(this.partyMenu.keyPressed(t))}drawBackground(){const t=new Image;t.src="battle_backgrounds.png",this.ctx.drawImage(t,522,5,270,155,0,0,this.ctx.width,this.ctx.height)}addSprites(){this.party.forEach((t,e)=>{let s=new Image;s.src=`image${e}.png`,t.sprite=s,t.index=e,t.draw(this.charIndexIncrease)})}drawMonsters(){this.enemies.forEach((t,e)=>{t.draw()})}onSelect(t){if(this.actionInProgress||"player-turn"!==this.battleState)return;this.actionInProgress=!0;const e=t.innerText;"Attack"===e?this.performAttack():"Defend"===e&&this.performDefend()}performAttack(){const t=this.enemies.filter(t=>t.isAlive());if(0===t.length)return void this.checkBattleEnd();const e=t[Math.floor(Math.random()*t.length)];this.currentChar.back=!1,this.currentChar.forward=!0,this.currentChar.attack(e),setTimeout(()=>{this.currentChar.back=!0,this.currentChar.forward=!1,this.actionInProgress=!1,this.nextTurn()},1e3)}performDefend(){console.log(`${this.currentChar.job} is defending!`),this.currentChar.defending=!0,setTimeout(()=>{this.actionInProgress=!1,this.nextTurn()},500)}nextTurn(){this.checkBattleEnd()||(this.charIndexIncrease(),0===this.currentCharIndex&&(this.battleState="enemy-turn",this.enemyTurn()))}enemyTurn(){const t=this.enemies.filter(t=>t.isAlive()),e=this.party.filter(t=>!t.KO);if(0===t.length||0===e.length)return void this.checkBattleEnd();let s=0;const i=setInterval(()=>{if(s>=t.length)return clearInterval(i),this.party.forEach(t=>t.defending=!1),void(this.battleState="player-turn");const n=t[s],a=e[Math.floor(Math.random()*e.length)];if(a&&!a.KO){let t=n.attack(a);a.defending&&(t=Math.floor(.5*t),a.health+=Math.floor(.5*t),console.log(`${a.job} defended and reduced damage!`))}s++},1e3)}checkBattleEnd(){const t=this.enemies.filter(t=>t.isAlive()),e=this.party.filter(t=>!t.KO&&t.health>0);return 0===t.length?(this.battleState="victory",console.log("Victory! All enemies defeated!"),this.showVictoryScreen(),!0):0===e.length&&(this.battleState="defeat",console.log("Defeat! All party members have fallen!"),this.showDefeatScreen(),!0)}showVictoryScreen(){setTimeout(()=>{alert("Victory! You defeated all enemies!"),this.resetBattle()},1e3)}showDefeatScreen(){setTimeout(()=>{alert("Defeat! Game Over!"),this.resetBattle()},1e3)}resetBattle(){this.party.forEach(t=>{t.health=t.maxHealth,t.KO=!1,t.defending=!1}),this.enemies=[],this.addEnemy(),this.currentCharIndex=0,this.battleState="player-turn",this.actionInProgress=!1}addEnemy(){const t=Math.floor(4*Math.random())+1;for(let e=0;e<t;e++){const t=new a(this.ctx,e);this.enemies.push(t)}}charIndexIncrease(){do{this.currentCharIndex>=3?this.currentCharIndex=0:this.currentCharIndex++}while(this.party[this.currentCharIndex]&&this.party[this.currentCharIndex].KO)}}class h{constructor(t){this.menu=t}start(){console.log(this.menu),this.menu}}class o{constructor(t,e,s,i){this.menu=t,this.game=e,this.tutorial=s,this.ctx=i.getContext("2d"),this.menuCtx=i.getContext("2d"),this.lastTime=0,this.title=document.getElementById("title-screen-text-wrapper"),this.time=0}start(){const t=document.getElementById("menu");t.addEventListener("mouseover",this.menu.selectMouseOver),t.addEventListener("click",t=>{this.selectEventCallback(t)}),document.addEventListener("keydown",t=>{this.selectEventCallback(t)})}selectEventCallback(t){const e=document.getElementById("menu");if(13!=t.keyCode||e.classList.contains("none")){if("click"!=t.type)return this.menu.keyPressed(t);this.select(this.menu.selectMouseClick(t))}else this.select(this.menu.keyPressed(t))}select(t){if("Start Game"===t.innerText){const t=document.getElementById("title-audio");this.title.classList.remove("appearing"),this.title.classList.add("disappearing"),t.volume=.3,this.game.ctx=this.ctx,this.title.addEventListener("animationend",()=>{this.title.classList.add("none"),t.pause(),document.getElementById("battleView").classList.remove("none"),this.game.start(this.menu)},{once:!0}),requestAnimationFrame(this.gameAnimate.bind(this))}else if("How To Play"===t.innerText){const t=new Menu("");this.tutorial.start(t)}}gameAnimate(t){this.time++,this.time>17&&(this.game.aniDone&&this.game.frame++,this.time=0,this.game.draw()),this.lastTime=t,requestAnimationFrame(this.gameAnimate.bind(this))}}function l(){setTimeout(()=>{const t=document.getElementById("title-audio"),e=document.getElementById("volume-slider"),s=document.getElementById("volume-display"),i=document.getElementById("mute-toggle");if(!(e&&s&&i&&t))return console.warn("Volume controls not found, retrying..."),void setTimeout(l,500);let n=!0;function a(){const i=Math.round(100*t.volume);s.textContent=i+"%",e.value=i}t.muted=n,e.addEventListener("input",e=>{const s=e.target.value/100;t.volume=s,a(),s>0&&n&&(n=!1,t.muted=!1,i.textContent="ðŸ”Š")}),i.addEventListener("click",()=>{n=!n,t.muted=n,i.textContent=n?"ðŸ”‡":"ðŸ”Š",!n&&t.paused&&t.play().catch(t=>console.log("Audio play failed:",t))}),a(),i.textContent=n?"ðŸ”‡":"ðŸ”Š",console.log("âœ… Volume controls initialized")},100)}function c(){setTimeout(()=>{const t=document.querySelector("#press-start h1");t?(t.style.animation="pressEnterStrobe 1.5s infinite",console.log("âœ… Strobe effect added")):setTimeout(c,500)},100)}document.addEventListener("DOMContentLoaded",()=>{const t=new i("#menu li","menu"),e=new h,s=document.getElementById("battle-view"),n=document.getElementById("enemies-ui"),a=document.getElementById("party-ui"),d=new r(s);s.width=.85*window.innerWidth,s.height=.8*window.innerHeight,n.width=.3*(s.width-50),n.height=window.innerHeight-s.height-50,a.width=.3*(s.width-50),a.height=window.innerHeight-s.height-50;const u=new o(t,d,e,s,n,a);l(),c();let m=0,p=!0;if(t.selection(0),p){let e=document.getElementById("press-start");e.addEventListener("animationend",(function(){console.log("remounted"),p=!1,document.body.addEventListener("keydown",(function(s){13==s.keyCode&&(e.classList.remove("title-screen-appearing"),t.cursorSelect.play(),e.classList.add("title-screen-disappear"))}))})),e.addEventListener("animationend",(function(){if(1===(m+=1))return;document.getElementById("title-screen-controller").classList.add("none"),u.start(),document.getElementById("title-screen-menu").classList.remove("none"),document.getElementById("title-audio").volume=.3}))}})}]);
//# sourceMappingURL=bundle.js.map